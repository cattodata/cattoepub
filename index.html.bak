<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bepub ‚Äî PDF to EPUB Converter (Thai)</title>
<meta name="description" content="‡πÅ‡∏õ‡∏•‡∏á PDF ‡πÄ‡∏õ‡πá‡∏ô EPUB ‡∏î‡πâ‡∏ß‡∏¢ Typhoon OCR ‚Äî ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìò</text></svg>">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Sarabun:wght@300;400;500;600&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}

:root{
  --bg:#f0f4fa;
  --bg2:#e4ecf7;
  --white:#ffffff;
  --border:#d6e0f0;
  --border2:#c4d1e8;
  --text:#111827;
  --text2:#4b5563;
  --text3:#9ca3af;
  --blue:#3b82f6;
  --blue-d:#2563eb;
  --blue-l:#dbeafe;
  --blue-xl:#eff6ff;
  --green:#10b981;
  --green-l:#d1fae5;
  --red:#ef4444;
  --red-l:#fee2e2;
  --amber:#f59e0b;
  --amber-l:#fef3c7;
  --r:8px;--r2:12px;--r3:16px;
}

html{font-size:15px;scroll-behavior:smooth}
body{
  font-family:'Sarabun','Plus Jakarta Sans',system-ui,sans-serif;
  background:var(--bg);color:var(--text);
  min-height:100vh;-webkit-font-smoothing:antialiased;
}

/* ‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê */
.hero{
  background:var(--white);
  border-bottom:1px solid var(--border);
  padding:2.5rem 1.25rem 2rem;
}
.hero-in{max-width:640px;margin:0 auto;text-align:center}
.hero h1{
  font-family:'Plus Jakarta Sans',sans-serif;
  font-size:2.2rem;font-weight:700;letter-spacing:-.03em;
  color:var(--text);line-height:1.2;margin-bottom:.35rem;
}
.hero h1 span{color:var(--blue)}
.hero-desc{font-size:.9rem;color:var(--text2);line-height:1.6;margin-bottom:1rem}
.tags{display:flex;gap:.4rem;justify-content:center;flex-wrap:wrap}
.tag{
  font-size:.68rem;font-weight:500;padding:.25rem .65rem;
  border-radius:100px;background:var(--blue-l);color:var(--blue-d);
  display:inline-flex;align-items:center;gap:.3rem;
}

/* ‚ïê‚ïê‚ïê LAYOUT ‚ïê‚ïê‚ïê */
.wrap{max-width:640px;margin:0 auto;padding:1.25rem 1rem 3rem}

/* ‚ïê‚ïê‚ïê TUTORIAL ‚ïê‚ïê‚ïê */
.tut{
  background:var(--white);border:1px solid var(--border);
  border-radius:var(--r3);margin-bottom:.75rem;overflow:hidden;
}
.tut-head{
  display:flex;align-items:center;justify-content:space-between;
  padding:1rem 1.25rem;cursor:pointer;user-select:none;
}
.tut-head h3{font-family:'Plus Jakarta Sans',sans-serif;font-size:.88rem;font-weight:600;color:var(--text);display:flex;align-items:center;gap:.4rem}
.tut-arr{font-size:.6rem;color:var(--text3);transition:transform .2s;width:22px;height:22px;border-radius:6px;background:var(--bg);display:flex;align-items:center;justify-content:center}
.tut.open .tut-arr{transform:rotate(180deg)}
.tut-body{display:none;padding:0 1.25rem 1.25rem;font-size:.82rem;line-height:1.75;color:var(--text2)}
.tut.open .tut-body{display:block}
.tut-steps{list-style:none;counter-reset:ts}
.tut-steps li{counter-increment:ts;padding:.55rem 0 .55rem 2rem;border-bottom:1px solid var(--bg);position:relative}
.tut-steps li:last-child{border:none}
.tut-steps li::before{
  content:counter(ts);position:absolute;left:0;top:.5rem;
  width:20px;height:20px;border-radius:6px;background:var(--blue);color:white;
  font-size:.62rem;font-weight:700;display:flex;align-items:center;justify-content:center;
}
.tut-steps b{color:var(--text);font-weight:600}
.tut-steps a{color:var(--blue);text-decoration:none}
.tut-steps a:hover{text-decoration:underline}
.tut-tip{
  margin-top:.7rem;padding:.55rem .75rem;background:var(--blue-xl);
  border-radius:var(--r);font-size:.76rem;color:var(--text2);
  border:1px solid var(--blue-l);
}

/* ‚ïê‚ïê‚ïê CARD ‚ïê‚ïê‚ïê */
.card{
  background:var(--white);border:1px solid var(--border);
  border-radius:var(--r3);padding:1.25rem;
  margin-bottom:.6rem;
  transition:border-color .15s;
}
.card:hover{border-color:var(--border2)}
.card-h{display:flex;align-items:center;gap:.5rem;margin-bottom:.85rem}
.card-n{
  width:22px;height:22px;border-radius:6px;flex-shrink:0;
  background:var(--blue);color:white;
  font-family:'Plus Jakarta Sans',sans-serif;font-size:.65rem;font-weight:700;
  display:flex;align-items:center;justify-content:center;
}
.card-t{font-family:'Plus Jakarta Sans',sans-serif;font-size:.88rem;font-weight:600}

/* ‚ïê‚ïê‚ïê FORM ‚ïê‚ïê‚ïê */
.f{margin-bottom:.7rem}.f:last-child{margin-bottom:0}
.fl{display:block;font-size:.7rem;font-weight:600;color:var(--text2);margin-bottom:.25rem;letter-spacing:.02em}
.fi{
  width:100%;padding:.5rem .65rem;
  background:var(--bg);border:1.5px solid var(--border);
  border-radius:var(--r);font-family:inherit;font-size:.84rem;
  color:var(--text);outline:none;transition:all .12s;
}
.fi:focus{border-color:var(--blue);box-shadow:0 0 0 3px var(--blue-l)}
.fi::placeholder{color:var(--text3)}
textarea.fi{resize:vertical;min-height:52px;line-height:1.5}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:.5rem}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:.5rem}

/* ‚ïê‚ïê‚ïê UPLOAD ‚ïê‚ïê‚ïê */
.up{
  border:2px dashed var(--border);border-radius:var(--r2);
  padding:1.5rem 1rem;text-align:center;cursor:pointer;
  transition:all .15s;background:var(--bg);
}
.up:hover,.up.drag{border-color:var(--blue);background:var(--blue-xl)}
.up.ok{border-color:var(--green);border-style:solid;background:var(--green-l)}
.up .ui{font-size:1.5rem;display:block;margin-bottom:.2rem}
.up .ut{font-size:.84rem;color:var(--text2)}.up .ut b{color:var(--text);font-weight:500}
.up .uh{font-size:.68rem;color:var(--text3);margin-top:.15rem}
.up .uf{font-size:.78rem;color:var(--green);font-weight:500;margin-top:.25rem}

/* Cover */
.cov{
  width:100px;height:140px;border:2px dashed var(--border);
  border-radius:var(--r);cursor:pointer;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;
  transition:all .15s;background:var(--bg);overflow:hidden;position:relative;
}
.cov:hover{border-color:var(--blue);background:var(--blue-xl)}
.cov.ok{border-style:solid;border-color:var(--green)}
.cov img{width:100%;height:100%;object-fit:cover;position:absolute;inset:0;z-index:1}
.cov-ph{text-align:center;font-size:.62rem;color:var(--text3)}
.cov-ph span{font-size:1.2rem;display:block;margin-bottom:.1rem}
.cov.ok .cov-ph{display:none}
.mflex{display:flex;gap:.75rem;align-items:flex-start}
.mfields{flex:1;min-width:0}

/* ‚ïê‚ïê‚ïê BUTTONS ‚ïê‚ïê‚ïê */
.brow{display:flex;gap:.4rem;margin:.6rem 0}
.btn{
  padding:.55rem 1rem;border:none;border-radius:var(--r);
  font-family:inherit;font-size:.82rem;font-weight:600;
  cursor:pointer;transition:all .12s;display:inline-flex;align-items:center;gap:.3rem;
}
.btn-go{
  background:var(--blue);color:white;flex:1;justify-content:center;
  box-shadow:0 1px 4px rgba(59,130,246,.2);
}
.btn-go:hover:not(:disabled){background:var(--blue-d);box-shadow:0 2px 8px rgba(59,130,246,.25)}
.btn-go:disabled{opacity:.4;cursor:not-allowed}
.btn-st{background:var(--white);border:1.5px solid var(--red);color:var(--red)}
.btn-st:hover:not(:disabled){background:var(--red-l)}
.btn-st:disabled{opacity:.3;cursor:not-allowed}
.btn-o{background:var(--white);border:1.5px solid var(--border);color:var(--text2);font-size:.72rem;padding:.35rem .6rem}
.btn-o:hover{background:var(--bg);border-color:var(--border2)}

/* ‚ïê‚ïê‚ïê PROGRESS ‚ïê‚ïê‚ïê */
.prg{display:none;margin-bottom:.6rem}.prg.on{display:block}
.prg-box{background:var(--white);border:1px solid var(--border);border-radius:var(--r2);padding:.85rem 1rem}
.prg-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:.4rem}
.prg-t{font-size:.78rem;color:var(--text2)}
.prg-p{font-size:.7rem;color:var(--text3);font-family:'JetBrains Mono',monospace}
.prg-track{height:5px;background:var(--bg2);border-radius:3px;overflow:hidden}
.prg-bar{height:100%;border-radius:3px;width:0%;background:var(--blue);transition:width .3s}
@keyframes pl{0%,100%{opacity:1}50%{opacity:.5}}
.prg.run .prg-t{animation:pl 1.5s infinite}

/* ‚ïê‚ïê‚ïê STATUS ‚ïê‚ïê‚ïê */
.sts{padding:.55rem .75rem;border-radius:var(--r);font-size:.78rem;display:none;margin-bottom:.6rem;border-left:3px solid}
.sts.info{display:block;background:var(--blue-xl);border-color:var(--blue);color:var(--blue-d)}
.sts.err{display:block;background:var(--red-l);border-color:var(--red);color:var(--red)}
.sts.ok{display:block;background:var(--green-l);border-color:var(--green);color:#059669}

/* ‚ïê‚ïê‚ïê RESULTS ‚ïê‚ïê‚ïê */
.res{display:none}.res.on{display:block}
.dlg{display:grid;grid-template-columns:1fr 1fr;gap:.5rem}
.dlc{
  display:flex;align-items:center;gap:.6rem;
  padding:.7rem .85rem;background:var(--bg);
  border:1.5px solid var(--border);border-radius:var(--r2);
  cursor:pointer;transition:all .15s;text-decoration:none;color:inherit;
}
.dlc:hover{border-color:var(--blue);background:var(--blue-xl);transform:translateY(-1px)}
.dli{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0}
.dli.epub{background:var(--green-l);color:var(--green)}
.dli.txt{background:var(--amber-l);color:var(--amber)}
.dln{font-size:.8rem;font-weight:600}
.dls{font-size:.64rem;color:var(--text3);margin-top:.08rem}

/* ‚ïê‚ïê‚ïê TOC ‚ïê‚ïê‚ïê */
.toc{display:none;margin-bottom:.6rem}.toc.on{display:block}
.tocl{list-style:none}
.toci{display:flex;align-items:center;gap:.4rem;padding:.35rem .4rem;border-radius:6px;font-size:.78rem;border-bottom:1px solid var(--bg)}
.toci:hover{background:var(--bg)}
.toci .tn{font-size:.62rem;color:var(--text3);font-weight:700;min-width:24px}
.toci input{flex:1;padding:.2rem .35rem;font-size:.78rem;border:1.5px solid var(--border);border-radius:5px;font-family:inherit;background:var(--white);color:var(--text);outline:none}
.toci input:focus{border-color:var(--blue)}
.toci .tp{font-size:.66rem;color:var(--text3);font-family:'JetBrains Mono',monospace}
.toci .tx{cursor:pointer;color:var(--text3);font-size:.68rem;padding:.15rem .2rem;border-radius:4px;transition:all .12s}
.toci .tx:hover{color:var(--red);background:var(--red-l)}
.toca{display:flex;gap:.3rem;margin-top:.4rem}

/* ‚ïê‚ïê‚ïê COLLAPSIBLE ‚ïê‚ïê‚ïê */
.ct{display:flex;align-items:center;gap:.3rem;font-size:.7rem;color:var(--text3);cursor:pointer;padding:.3rem 0;user-select:none}
.ct:hover{color:var(--text2)}
.ct .a{transition:transform .15s;font-size:.5rem}.ct.open .a{transform:rotate(90deg)}
.cb{display:none}.cb.open{display:block}

.logb{background:var(--bg);border:1px solid var(--border);border-radius:var(--r);padding:.4rem .6rem;max-height:160px;overflow-y:auto;margin-top:.2rem;font-family:'JetBrains Mono',monospace;font-size:.62rem;line-height:1.75;color:var(--text3)}
.ll{border-bottom:1px solid var(--bg2);padding:.04rem 0}.ll:last-child{border:none}
.ll .t{color:var(--border2);margin-right:.25rem}
.ll.e{color:var(--red)}.ll.s{color:var(--green)}

.pvb{background:var(--bg);border:1px solid var(--border);border-radius:var(--r);padding:.6rem .75rem;max-height:260px;overflow-y:auto;margin-top:.2rem;font-size:.76rem;line-height:1.75;color:var(--text2);white-space:pre-wrap;word-break:break-word}

::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}

.foot{text-align:center;padding:1.25rem 0;margin-top:1.25rem;font-size:.62rem;color:var(--text3);border-top:1px solid var(--border)}
.foot a{color:var(--blue);text-decoration:none}.foot a:hover{text-decoration:underline}

@media(max-width:640px){
  .hero h1{font-size:1.7rem}
  .hero{padding:2rem 1rem 1.5rem}
  .wrap{padding:1rem .75rem 2rem}
  .g2,.g3,.dlg{grid-template-columns:1fr}
  .mflex{flex-direction:column;align-items:center}
  .brow{flex-direction:column}
  .btn-go{width:100%}
}
</style>
</head>
<body>

<header class="hero">
  <div class="hero-in">
    <h1>üìò B<span>epub</span></h1>
    <p class="hero-desc">PDF to EPUB Converter (Thai)<br>‡πÅ‡∏õ‡∏•‡∏á PDF ‡πÄ‡∏õ‡πá‡∏ô EPUB ‡∏î‡πâ‡∏ß‡∏¢ Typhoon OCR ‚Äî ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á</p>
    <div class="tags">
      <span class="tag">üáπüá≠ Thai OCR</span>
      <span class="tag">üì± Mobile Ready</span>
      <span class="tag">üîí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</span>
      <span class="tag">‚ö° Client-Side</span>
    </div>
    <p style="font-size:.68rem;color:var(--text3);margin-top:.75rem;line-height:1.5">üí° Based on <strong>Bepub</strong> by <a href="https://www.facebook.com/groups/ebookreader/posts/25556985560668239" target="_blank" style="color:var(--blue);text-decoration:none">Ken Takahashi</a> (<a href="https://colab.research.google.com/drive/1lgmYkuEeSUlVDLpplXCnFIQdJP9YMWjw?usp=sharing" target="_blank" style="color:var(--blue);text-decoration:none;font-size:.64rem">Colab</a>)<br>Web adaptation by <strong style="color:var(--blue)">rainflowData</strong></p>
  </div>
</header>

<div class="wrap">

  <!-- Tutorial -->
  <div class="tut open" id="tut">
    <div class="tut-head" id="tut-tog">
      <h3>üìñ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
      <div class="tut-arr">‚ñº</div>
    </div>
    <div class="tut-body">
      <ol class="tut-steps">
        <li><b>‡∏™‡∏°‡∏±‡∏Ñ‡∏£ Typhoon API Key</b> ‚Äî ‡πÑ‡∏õ‡∏ó‡∏µ‡πà <a href="https://opentyphoon.ai" target="_blank">opentyphoon.ai</a> ‡∏Å‡∏î Sign Up ‚Üí ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î‡∏ó‡∏µ‡πà <b>Profile (avatar ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô)</b> ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <b>API Keys</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á key</li>
        <li><b>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î PDF</b> ‚Äî ‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö PDF ‡∏†‡∏≤‡∏û‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏î‡πâ</li>
        <li><b>‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</b> ‚Äî Title, Author, Publisher, ‡∏õ‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</li>
        <li><b>‡∏Å‡∏î "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå"</b> ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö OCR ‡∏ó‡∏µ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á EPUB ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
        <li><b>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç</b> ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ö‡∏ó/‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà</li>
        <li><b>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</b> ‚Äî ‡πÑ‡∏î‡πâ EPUB + TXT ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏ö‡∏ô e-reader</li>
      </ol>
      <div class="tut-tip">
        üí° <b>Deploy GitHub Pages:</b> ‡∏™‡∏£‡πâ‡∏≤‡∏á repo ‚Üí ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î <code>index.html</code> ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‚Üí Settings ‚Üí Pages ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å branch ‚Üí Save!
      </div>
    </div>
  </div>

  <!-- Step 1 -->
  <div class="card">
    <div class="card-h"><div class="card-n">1</div><div class="card-t">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î PDF</div></div>
    <div class="up" id="dz">
      <span class="ui">üìÑ</span>
      <div class="ut"><b>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</b> ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡∏°‡∏≤‡∏ß‡∏≤‡∏á</div>
      <div class="uh">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö .pdf ‚Äî ‡πÑ‡∏ü‡∏•‡πå‡∏™‡πÅ‡∏Å‡∏ô‡∏Å‡πá‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</div>
      <div class="uf" id="fn"></div>
    </div>
    <input type="file" id="fi" accept=".pdf" hidden>
  </div>

  <!-- Step 2 -->
  <div class="card">
    <div class="card-h"><div class="card-n">2</div><div class="card-t">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</div></div>
    <div class="f"><label class="fl">Typhoon OCR API Key</label><input type="password" class="fi" id="ak" placeholder="typhoon-xxxxxxxx" autocomplete="off"></div>
    <div class="g3">
      <div class="f"><label class="fl">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏´‡∏ô‡πâ‡∏≤</label><input type="number" class="fi" id="sp" value="1" min="1"></div>
      <div class="f"><label class="fl">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏´‡∏ô‡πâ‡∏≤</label><input type="number" class="fi" id="ep" value="0" min="0" placeholder="0=‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"></div>
      <div class="f"><label class="fl">‡∏•‡∏ö‡∏Ñ‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞</label><input type="text" class="fi" id="cr" placeholder="‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ ,"></div>
    </div>
  </div>

  <!-- Step 3 -->
  <div class="card">
    <div class="card-h"><div class="card-n">3</div><div class="card-t">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</div></div>
    <div class="mflex">
      <div class="cov" id="cz"><div class="cov-ph"><span>üñºÔ∏è</span>Cover</div></div>
      <input type="file" id="ci" accept="image/*" hidden>
      <div class="mfields">
        <div class="g2">
          <div class="f"><label class="fl">Title</label><input type="text" class="fi" id="mt" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠"></div>
          <div class="f"><label class="fl">Author</label><input type="text" class="fi" id="ma" placeholder="‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á"></div>
        </div>
        <div class="g2">
          <div class="f"><label class="fl">Publisher</label><input type="text" class="fi" id="mp" placeholder="‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå"></div>
          <div class="f"><label class="fl">Language</label><input type="text" class="fi" id="ml" value="th"></div>
        </div>
        <div class="f"><label class="fl">Description</label><textarea class="fi" id="md" rows="2" placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)"></textarea></div>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="brow">
    <button class="btn btn-go" id="bgo" disabled>‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå</button>
    <button class="btn btn-st" id="bst" disabled>‚ñ† ‡∏´‡∏¢‡∏∏‡∏î</button>
  </div>

  <div class="prg" id="prg">
    <div class="prg-box">
      <div class="prg-top"><span class="prg-t" id="pt">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</span><span class="prg-p" id="pp">0%</span></div>
      <div class="prg-track"><div class="prg-bar" id="pb"></div></div>
    </div>
  </div>

  <div class="sts" id="sts"></div>

  <div class="res" id="res">
    <div class="card">
      <div class="card-h"><div class="card-n" style="background:var(--green)">‚úì</div><div class="card-t">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</div></div>
      <div class="dlg">
        <a class="dlc" id="de" href="#" download><div class="dli epub">üìï</div><div><div class="dln">EPUB</div><div class="dls" id="es">‚Äî</div></div></a>
        <a class="dlc" id="dt" href="#" download><div class="dli txt">üìù</div><div><div class="dln">TXT</div><div class="dls" id="ts">‚Äî</div></div></a>
      </div>
    </div>
  </div>

  <div class="toc" id="tocsec">
    <div class="card">
      <div class="card-h"><div class="card-n" style="background:var(--amber)">üìë</div><div class="card-t">‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç</div></div>
      <p style="font-size:.7rem;color:var(--text3);margin-bottom:.4rem">‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏à‡∏≤‡∏Å OCR ‚Äî ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏•‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ</p>
      <ul class="tocl" id="tocl"></ul>
      <div class="toca"><button class="btn btn-o" id="bac">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏ó</button><button class="btn btn-o" id="brb">üîÑ ‡∏™‡∏£‡πâ‡∏≤‡∏á EPUB ‡πÉ‡∏´‡∏°‡πà</button></div>
    </div>
  </div>

  <div id="pvsec" style="display:none;margin-top:.3rem">
    <div class="ct" id="pvt"><span class="a">‚ñ∂</span> ‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</div>
    <div class="cb pvb" id="pvb"></div>
  </div>

  <div style="margin-top:.3rem">
    <div class="ct" id="lt"><span class="a">‚ñ∂</span> Console Log</div>
    <div class="cb logb" id="lb"></div>
  </div>

  <div class="foot">
    <strong>Original concept:</strong> Bepub by Ken Takahashi (<a href="https://colab.research.google.com/drive/1lgmYkuEeSUlVDLpplXCnFIQdJP9YMWjw?usp=sharing" target="_blank" style="color:var(--text3);text-decoration:none;font-size:.58rem">Colab</a>) ¬∑ <strong>Web version:</strong> rainflowData<br>
    Built with <a href="https://opentyphoon.ai" target="_blank">Typhoon OCR</a> ¬∑ <a href="https://mozilla.github.io/pdf.js/" target="_blank">PDF.js</a> ¬∑ <a href="https://stuk.github.io/jszip/" target="_blank">JSZip</a><br>
    <span style="font-size:.58rem;color:var(--text3)">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå ¬∑ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Typhoon API ¬∑ ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏î‡πÜ<br>Shared in <a href="https://www.facebook.com/groups/778412228952249/" target="_blank" style="color:var(--text3);text-decoration:none">‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏ô‡∏±‡∏Å‡∏≠‡πà‡∏≤‡∏ô eBook</a></span>
  </div>
</div>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
let pdfFile,pdfDoc,isCancelled=false,isProc=false,coverUrl,coverMime,ocrS=[],chaps=[];
const $=id=>document.getElementById(id);

$('tut-tog').onclick=()=>$('tut').classList.toggle('open');
document.querySelectorAll('.ct').forEach(e=>e.onclick=function(){this.classList.toggle('open');this.nextElementSibling.classList.toggle('open')});

function log(m,t=''){const d=document.createElement('div');d.className='ll '+(t==='error'?'e':t==='success'?'s':'');d.innerHTML=`<span class="t">${new Date().toLocaleTimeString('th',{hour12:0})}</span>${m}`;$('lb').appendChild(d);$('lb').scrollTop=9e9}
function setSt(m,t){$('sts').className='sts '+t;$('sts').textContent=m}

const dz=$('dz'),fi=$('fi');
dz.onclick=()=>fi.click();
dz.ondragover=e=>{e.preventDefault();dz.classList.add('drag')};
dz.ondragleave=()=>dz.classList.remove('drag');
dz.ondrop=e=>{e.preventDefault();dz.classList.remove('drag');e.dataTransfer.files[0]&&hf(e.dataTransfer.files[0])};
fi.onchange=()=>fi.files[0]&&hf(fi.files[0]);

async function hf(f){
  if(!f.name.toLowerCase().endsWith('.pdf'))return setSt('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô','err');
  pdfFile=f;dz.classList.add('ok');
  $('fn').textContent=`${f.name} (${fs(f.size)})`;
  $('mt').placeholder=f.name.replace(/\.pdf$/i,'');
  log('‡πÇ‡∏´‡∏•‡∏î: '+f.name);
  try{pdfDoc=await pdfjsLib.getDocument({data:await f.arrayBuffer()}).promise;log(`PDF ${pdfDoc.numPages} ‡∏´‡∏ô‡πâ‡∏≤`,'success');ck()}
  catch(e){log('‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: '+e.message,'error');setSt('‡∏≠‡πà‡∏≤‡∏ô PDF ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ','err')}
}

$('cz').onclick=()=>$('ci').click();
$('ci').onchange=()=>{const f=$('ci').files[0];if(!f)return;coverMime=f.type;const r=new FileReader();r.onload=e=>{coverUrl=e.target.result;$('cz').classList.add('ok');const o=$('cz').querySelector('img');if(o)o.remove();const i=document.createElement('img');i.src=coverUrl;$('cz').appendChild(i);log('‡∏õ‡∏Å: '+f.name,'success')};r.readAsDataURL(f)};

function ck(){$('bgo').disabled=!(pdfDoc&&$('ak').value.trim())}
$('ak').oninput=ck;
$('bst').onclick=()=>{isCancelled=true;log('üõë ‡∏´‡∏¢‡∏∏‡∏î','error')};

async function rp(n,d=1800){const pg=await pdfDoc.getPage(n),v=pg.getViewport({scale:1}),s=d/Math.max(v.width,v.height),vp=pg.getViewport({scale:s}),c=document.createElement('canvas');c.width=vp.width;c.height=vp.height;await pg.render({canvasContext:c.getContext('2d'),viewport:vp}).promise;const u=c.toDataURL('image/png');return{b:u.split(',')[1],w:Math.round(vp.width),h:Math.round(vp.height)}}

async function ocr(b,w,h,k){
  const p=`Below is an image of a document page along with its dimensions.\nimage_width: ${w}\nimage_height: ${h}\n\nExtract all the text content from this document page. Maintain the original structure including headings, paragraphs, lists, and tables. Output the result in clean markdown format.`;
  const r=await fetch('https://api.opentyphoon.ai/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+k},body:JSON.stringify({model:'typhoon-ocr',messages:[{role:'user',content:[{type:'text',text:p},{type:'image_url',image_url:{url:'data:image/png;base64,'+b}}]}],max_tokens:16384,temperature:0.1})});
  if(!r.ok)throw new Error(`API ${r.status}: ${await r.text()}`);return(await r.json()).choices?.[0]?.message?.content||'';
}

function cl(t,cw){let c=t.replace(/<\/?page_number[^>]*>/gi,'').replace(/<page_number>[^<]*<\/page_number>/gi,'').replace(/<[^>]*page_number[^>]*>[^<]*<\/[^>]*>/gi,'');c=c.replace(/\n\*\s*\d+\s*\n/g,'\n').replace(/\*\s*\d+\s*\*/g,'').replace(/\\'/g,'');if(cw)cw.split(',').map(w=>w.trim()).filter(Boolean).forEach(w=>{c=c.split(w).join('')});return c.replace(/\n\s*\n\s*\n/g,'\n\n').normalize('NFC').trim()}

function dch(ss){const ch=[];const ps=[/^#{1,3}\s+(.+)/m,/^(‡∏ö‡∏ó‡∏ó‡∏µ‡πà\s*\d+[^\n]*)/m,/^(‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà\s*\d+[^\n]*)/m,/^(Chapter\s+\d+[^\n]*)/im,/^(‡∏†‡∏≤‡∏Ñ(?:‡∏ó‡∏µ‡πà)?\s*\d+[^\n]*)/m,/^(Part\s+\d+[^\n]*)/im,/^(‡∏ö‡∏ó‡∏ô‡∏≥|‡∏Ñ‡∏≥‡∏ô‡∏≥|‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç|‡∏≠‡∏≤‡∏£‡∏±‡∏°‡∏†‡∏ö‡∏ó|‡∏ö‡∏ó‡∏™‡πà‡∏á‡∏ó‡πâ‡∏≤‡∏¢|‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ|‡∏†‡∏≤‡∏Ñ‡∏ú‡∏ô‡∏ß‡∏Å|‡∏Ñ‡∏≥‡∏≠‡∏∏‡∏ó‡∏¥‡∏®|‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®)/m];ss.forEach((s,i)=>{for(const p of ps){const m=s.match(p);if(m){let t=m[1].replace(/^#+\s*/,'').trim();if(t.length>60)t=t.slice(0,60)+'‚Ä¶';if(!ch.some(x=>x.title===t))ch.push({title:t,pi:i});break}}});return ch}

function rtoc(){const l=$('tocl');l.innerHTML='';if(!chaps.length){$('tocsec').classList.remove('on');return}$('tocsec').classList.add('on');chaps.forEach((c,i)=>{const li=document.createElement('li');li.className='toci';li.innerHTML=`<span class="tn">${i+1}.</span><input value="${esc(c.title)}" data-i="${i}"><span class="tp">p.${c.pi+1}</span><span class="tx" data-i="${i}">‚úï</span>`;l.appendChild(li)});l.querySelectorAll('input').forEach(i=>i.onchange=()=>{chaps[+i.dataset.i].title=i.value});l.querySelectorAll('.tx').forEach(b=>b.onclick=()=>{chaps.splice(+b.dataset.i,1);rtoc()})}
$('bac').onclick=()=>{const p=prompt('‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏ó:');if(!p)return;const n=+p;if(!n||n<1)return;const t=prompt('‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó:')||`‡∏ö‡∏ó‡∏ó‡∏µ‡πà ${chaps.length+1}`;chaps.push({title:t,pi:n-1});chaps.sort((a,b)=>a.pi-b.pi);rtoc()};

async function mke(ss,ch){
  const z=new JSZip(),m={t:$('mt').value.trim()||pdfFile.name.replace(/\.pdf$/i,''),a:$('ma').value.trim()||'Unknown',p:$('mp').value.trim(),l:$('ml').value.trim()||'th',d:$('md').value.trim()},uid='bepub-'+Date.now();
  z.file('mimetype','application/epub+zip',{compression:'STORE'});
  z.file('META-INF/container.xml','<?xml version="1.0"?><container version="1.0" xmlns="urn:oasis:names:tc:opendocument:xmlns:container"><rootfiles><rootfile full-path="OEBPS/content.opf" media-type="application/oebps-package+xml"/></rootfiles></container>');
  z.file('OEBPS/style.css',`@import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap');body{font-family:'Sarabun',sans-serif;line-height:1.9;padding:1.2em;color:#1a1a1a;max-width:38em;margin:0 auto}h1{font-size:1.6em;margin:1.5em 0 .5em;font-weight:600}h2{font-size:1.3em;margin:1.3em 0 .4em}h3{font-size:1.1em;margin:1.1em 0 .3em}p{margin:.4em 0;text-indent:1.5em;text-align:justify}table{border-collapse:collapse;width:100%;margin:1em 0}td,th{border:1px solid #ddd;padding:.5em .7em}blockquote{border-left:3px solid #ccc;padding-left:1em;color:#555;margin:1em 0}img.cover{max-width:100%;display:block;margin:0 auto}`);
  let mf='<item id="css" href="style.css" media-type="text/css"/>\n',sp='',nav='',po=1,pfm={};
  if(coverUrl){const ext=coverMime?.includes('png')?'png':'jpg',mt=coverMime||'image/jpeg';z.file(`OEBPS/cover.${ext}`,Uint8Array.from(atob(coverUrl.split(',')[1]),c=>c.charCodeAt(0)));mf+=`<item id="cover-img" href="cover.${ext}" media-type="${mt}"/>\n`;z.file('OEBPS/cover.xhtml',`<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="UTF-8"/><link rel="stylesheet" href="style.css"/></head><body><div style="text-align:center"><img class="cover" src="cover.${ext}" alt="Cover"/></div></body></html>`);mf+=`<item id="cover" href="cover.xhtml" media-type="application/xhtml+xml"/>\n`;sp+=`<itemref idref="cover"/>\n`;nav+=`<navPoint id="cover" playOrder="${po++}"><navLabel><text>‡∏õ‡∏Å</text></navLabel><content src="cover.xhtml"/></navPoint>\n`}
  ss.forEach((s,i)=>{if(!s.trim())return;const fn=`p${i}.xhtml`;pfm[i]=fn;z.file(`OEBPS/${fn}`,`<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="${ex(m.l)}"><head><meta charset="UTF-8"/><link rel="stylesheet" href="style.css"/></head><body>${m2h(s.trim())}</body></html>`);mf+=`<item id="p${i}" href="${fn}" media-type="application/xhtml+xml"/>\n`;sp+=`<itemref idref="p${i}"/>\n`});
  if(ch.length)ch.forEach((c,i)=>{const fn=pfm[c.pi]||`p${c.pi}.xhtml`;nav+=`<navPoint id="ch${i}" playOrder="${po++}"><navLabel><text>${ex(c.title)}</text></navLabel><content src="${fn}"/></navPoint>\n`});
  else ss.forEach((s,i)=>{if(s.trim())nav+=`<navPoint id="n${i}" playOrder="${po++}"><navLabel><text>‡∏´‡∏ô‡πâ‡∏≤ ${i+1}</text></navLabel><content src="p${i}.xhtml"/></navPoint>\n`});
  let mx=`<dc:title>${ex(m.t)}</dc:title><dc:language>${ex(m.l)}</dc:language><dc:identifier id="uid">${uid}</dc:identifier><dc:creator>${ex(m.a)}</dc:creator>`;
  if(m.p)mx+=`<dc:publisher>${ex(m.p)}</dc:publisher>`;if(m.d)mx+=`<dc:description>${ex(m.d)}</dc:description>`;if(coverUrl)mx+=`<meta name="cover" content="cover-img"/>`;
  z.file('OEBPS/content.opf',`<?xml version="1.0" encoding="UTF-8"?><package xmlns="http://www.idpf.org/2007/opf" version="2.0" unique-identifier="uid"><metadata xmlns:dc="http://purl.org/dc/elements/1.1/">${mx}</metadata><manifest>${mf}<item id="ncx" href="toc.ncx" media-type="application/x-dtbncx+xml"/></manifest><spine toc="ncx">${sp}</spine></package>`);
  z.file('OEBPS/toc.ncx',`<?xml version="1.0" encoding="UTF-8"?><ncx xmlns="http://www.daisy.org/z3986/2005/ncx/" version="2005-1"><head><meta name="dtb:uid" content="${uid}"/></head><docTitle><text>${ex(m.t)}</text></docTitle><navMap>${nav}</navMap></ncx>`);
  return z.generateAsync({type:'blob',mimeType:'application/epub+zip'});
}

function m2h(md){let h=eh(md);h=h.replace(/^(\|.+\|)\n(\|[-| :]+\|)\n((?:\|.+\|\n?)+)/gm,(_,hd,_s,bd)=>{const ths=hd.split('|').filter(c=>c.trim()).map(c=>`<th>${c.trim()}</th>`).join('');const rows=bd.trim().split('\n').map(r=>`<tr>${r.split('|').filter(c=>c.trim()).map(c=>`<td>${c.trim()}</td>`).join('')}</tr>`).join('');return`<table><thead><tr>${ths}</tr></thead><tbody>${rows}</tbody></table>`});h=h.replace(/^### (.+)$/gm,'<h3>$1</h3>');h=h.replace(/^## (.+)$/gm,'<h2>$1</h2>');h=h.replace(/^# (.+)$/gm,'<h1>$1</h1>');h=h.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>');h=h.replace(/\*(.+?)\*/g,'<em>$1</em>');h=h.replace(/^&gt;\s?(.+)$/gm,'<blockquote>$1</blockquote>');h=h.replace(/^[-*]\s+(.+)$/gm,'<li>$1</li>');h=h.replace(/((?:<li>.+<\/li>\n?)+)/g,'<ul>$1</ul>');return h.split(/\n\n+/).map(p=>{p=p.trim();if(!p)return'';if(/^<(h[1-3]|table|ul|blockquote)/.test(p))return p;return`<p>${p.replace(/\n/g,'<br/>')}</p>`}).join('\n')}
function eh(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
function ex(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
function esc(s){return s.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;')}

$('brb').onclick=async()=>{if(!ocrS.length)return setSt('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•','err');log('üîÑ Rebuild...');try{const b=await mke(ocrS,chaps);const nm=$('mt').value.trim()||pdfFile.name.replace(/\.pdf$/i,'');$('de').href=URL.createObjectURL(b);$('de').download=nm+'.epub';$('es').textContent=fs(b.size);setSt('‚úÖ EPUB ‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß','ok');log('‚úÖ Done','success')}catch(e){setSt('‚ùå '+e.message,'err');log(e.message,'error')}};

$('bgo').onclick=async()=>{
  if(isProc)return;isProc=true;isCancelled=false;
  const key=$('ak').value.trim(),s0=Math.max(1,+$('sp').value||1),e0=+$('ep').value||0,tot=pdfDoc.numPages,end=(e0===0||e0>tot)?tot:e0,cw=$('cr').value;
  if(s0>end){setSt('‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô > ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î','err');isProc=false;return}
  $('bgo').disabled=true;$('bst').disabled=false;$('res').classList.remove('on');$('tocsec').classList.remove('on');
  $('prg').classList.add('on','run');setSt(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏ô‡πâ‡∏≤ ${s0}‚Äì${end}`,'info');
  const base=$('mt').value.trim()||pdfFile.name.replace(/\.pdf$/i,'');
  ocrS=[];let full='',done=0;const cnt=end-s0+1;
  log(`‡πÄ‡∏£‡∏¥‡πà‡∏°: ${s0}‚Äì${end} (${cnt} ‡∏´‡∏ô‡πâ‡∏≤)`);
  for(let p=s0;p<=end;p++){
    if(isCancelled)break;
    const pct=Math.round(done/cnt*100);$('pt').textContent=`OCR ‡∏´‡∏ô‡πâ‡∏≤ ${p}/${end}`;$('pp').textContent=pct+'%';$('pb').style.width=pct+'%';
    try{log(`üìÑ ${p}...`);const{b,w,h}=await rp(p);log(`üîç OCR ${p}`);let t=await ocr(b,w,h,key);t=cl(t,cw);if(t){ocrS.push(t);full+=t+'\n\n--- Page Break ---\n\n';log(`‚úÖ ${p}: ${t.length}`,'success')}else{ocrS.push('');log(`‚ö†Ô∏è ${p}: empty`,'error')}}
    catch(e){ocrS.push('');log(`‚ùå ${p}: ${e.message}`,'error')}
    done++;
  }
  $('pb').style.width='100%';$('pp').textContent='100%';$('prg').classList.remove('run');
  if(full.trim()){try{
    chaps=dch(ocrS);log(`üìë ${chaps.length} chapters`);rtoc();log('üì¶ Building...');
    const eb=await mke(ocrS,chaps),tb=new Blob(['\ufeff'+full],{type:'text/plain;charset=utf-8'});
    $('de').href=URL.createObjectURL(eb);$('de').download=base+'.epub';$('es').textContent=fs(eb.size);
    $('dt').href=URL.createObjectURL(tb);$('dt').download=base+'.txt';$('ts').textContent=fs(tb.size);
    $('res').classList.add('on');$('pvsec').style.display='block';
    $('pvb').textContent=full.substring(0,5000)+(full.length>5000?'\n‚Ä¶(5,000 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏£‡∏Å)':'');
    setSt(isCancelled?`üõë ‡∏´‡∏¢‡∏∏‡∏î ‚Äî ‡πÑ‡∏î‡πâ ${done} ‡∏´‡∏ô‡πâ‡∏≤`:`‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ${done} ‡∏´‡∏ô‡πâ‡∏≤`,'ok');log('üéâ','success');
  }catch(e){setSt('‚ùå '+e.message,'err');log(e.message,'error')}}
  else setSt('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤','err');
  $('bgo').disabled=false;$('bst').disabled=true;isProc=false;
};

function fs(b){return b<1024?b+' B':b<1048576?(b/1024).toFixed(1)+' KB':(b/1048576).toFixed(1)+' MB'}
</script>
</body>
</html>
